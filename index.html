<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> Global Cities Weather </title> 
  <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-100 to-sky-200 flex flex-col items-center p-4">

  <h1 class="text-3xl sm:text-4xl font-bold text-slate-800 mb-6 text-center">ğŸŒ Global City Weather</h1>
  <p class="text-gray-600 text-sm mb-4 text-center">Click any city below to see current conditions and forecast</p>

  <!-- City Grid -->
  <div id="city-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 w-full max-w-5xl mb-8">
  </div>

  <!-- Weather Card -->
  <div id="weather-card" class="hidden w-full max-w-2xl bg-white/90 backdrop-blur-md rounded-2xl shadow-lg p-6 text-center">
    <div id="weather-emoji" class="text-6xl mb-2">â›…</div>
    <h2 id="weather-city" class="text-2xl font-bold text-slate-800 mb-1"></h2>
    <p id="weather-flag" class="text-4xl mb-3"></p>
    <p id="weather-temp" class="text-5xl font-extrabold text-slate-800">--Â°F</p>
    <p id="weather-desc" class="text-lg text-slate-600 mt-2">Loading...</p>
    <p id="weather-meta" class="text-xs text-slate-500 mt-2">â€”</p>

    <!-- 7-Day Forecast -->
    <div id="forecast" class="mt-6 grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-3 text-center"></div>

    <button onclick="hideWeather()" class="mt-6 w-full py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition">Close</button>
  </div>

  <div id="error" class="hidden text-sm text-red-600 mt-3"></div>

<script>
const cities = [
  { name: "London", flag: "ğŸ‡¬ğŸ‡§", lat: 51.5072, lon: -0.1276, tz: "Europe/London" },
  { name: "Paris", flag: "ğŸ‡«ğŸ‡·", lat: 48.8566, lon: 2.3522, tz: "Europe/Paris" },
  { name: "Rome", flag: "ğŸ‡®ğŸ‡¹", lat: 41.9028, lon: 12.4964, tz: "Europe/Rome" },
  { name: "Barcelona", flag: "ğŸ‡ªğŸ‡¸", lat: 41.3874, lon: 2.1686, tz: "Europe/Madrid" },
  { name: "Toronto", flag: "ğŸ‡¨ğŸ‡¦", lat: 43.6532, lon: -79.3832, tz: "America/Toronto" },
  { name: "Vancouver", flag: "ğŸ‡¨ğŸ‡¦", lat: 49.2827, lon: -123.1207, tz: "America/Vancouver" },
  { name: "Chicago", flag: "ğŸ‡ºğŸ‡¸", lat: 41.8781, lon: -87.6298, tz: "America/Chicago" },
  { name: "Tulsa", flag: "ğŸ‡ºğŸ‡¸", lat: 36.1539, lon: -95.9928, tz: "America/Chicago" },
  { name: "Yangon", flag: "ğŸ‡²ğŸ‡²", lat: 16.8409, lon: 96.1735, tz: "Asia/Yangon" },
  { name: "Bangkok", flag: "ğŸ‡¹ğŸ‡­", lat: 13.7563, lon: 100.5018, tz: "Asia/Bangkok" },
  { name: "Kuala Lumpur", flag: "ğŸ‡²ğŸ‡¾", lat: 3.139, lon: 101.6869, tz: "Asia/Kuala_Lumpur" },
  { name: "Seoul", flag: "ğŸ‡°ğŸ‡·", lat: 37.5665, lon: 126.978, tz: "Asia/Seoul" },
  { name: "Tokyo", flag: "ğŸ‡¯ğŸ‡µ", lat: 35.6762, lon: 139.6503, tz: "Asia/Tokyo" },
  { name: "Singapore", flag: "ğŸ‡¸ğŸ‡¬", lat: 1.3521, lon: 103.8198, tz: "Asia/Singapore" },
];

const weatherMap = {
  0: {desc: 'Clear sky', emoji: 'â˜€ï¸'},
  1: {desc: 'Mainly clear', emoji: 'ğŸŒ¤ï¸'},
  2: {desc: 'Partly cloudy', emoji: 'â›…'},
  3: {desc: 'Overcast', emoji: 'â˜ï¸'},
  45: {desc: 'Fog', emoji: 'ğŸŒ«ï¸'},
  51: {desc: 'Light drizzle', emoji: 'ğŸŒ¦ï¸'},
  61: {desc: 'Rain', emoji: 'ğŸŒ§ï¸'},
  63: {desc: 'Showers', emoji: 'ğŸŒ¦ï¸'},
  65: {desc: 'Heavy rain', emoji: 'â›ˆï¸'},
  71: {desc: 'Snow', emoji: 'â„ï¸'},
  95: {desc: 'Thunderstorm', emoji: 'â›ˆï¸'}
};

const toF = c => (c * 9/5) + 32;

const cityGrid = document.getElementById('city-grid');
const weatherCard = document.getElementById('weather-card');
const tempEl = document.getElementById('weather-temp');
const descEl = document.getElementById('weather-desc');
const emojiEl = document.getElementById('weather-emoji');
const cityEl = document.getElementById('weather-city');
const flagEl = document.getElementById('weather-flag');
const metaEl = document.getElementById('weather-meta');
const forecastEl = document.getElementById('forecast');
const errorEl = document.getElementById('error');

// Fetch all temperatures first and sort
async function fetchAllTempsAndRender() {
  const citiesWithTemp = [];
  for (const city of cities) {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true&timezone=${encodeURIComponent(city.tz)}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      const tempF = Math.round(toF(data.current_weather.temperature));
      citiesWithTemp.push({ ...city, tempF });
    } catch {
      citiesWithTemp.push({ ...city, tempF: Infinity }); // sort last if failed
    }
  }
  // Sort coldest to hottest
  citiesWithTemp.sort((a,b) => a.tempF - b.tempF);

  // Render city grid
  citiesWithTemp.forEach(city => {
    const div = document.createElement('div');
    div.className = "bg-white rounded-xl shadow hover:shadow-lg transition p-4 text-center cursor-pointer";
    div.innerHTML = `
      <div class="text-3xl">${city.flag}</div>
      <p class="text-sm font-bold text-slate-700">${city.name}</p>
      <p class="text-xs text-slate-500">${city.tempF !== Infinity ? city.tempF + 'Â°F' : 'N/A'}</p>
    `;
    div.onclick = () => showWeather(city);
    cityGrid.appendChild(div);
  });
}

async function showWeather(city) {
  weatherCard.classList.remove('hidden');
  cityEl.textContent = city.name;
  flagEl.textContent = city.flag;
  tempEl.textContent = '--Â°F';
  descEl.textContent = 'Loading...';
  metaEl.textContent = '';
  forecastEl.innerHTML = '';

  const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&daily=weathercode,temperature_2m_max,temperature_2m_min&current_weather=true&timezone=${encodeURIComponent(city.tz)}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    const cur = data.current_weather;
    const {emoji, desc} = weatherMap[cur.weathercode] || {emoji:'â“',desc:'Unknown'};

    emojiEl.textContent = emoji;
    tempEl.textContent = `${Math.round(toF(cur.temperature))}Â°F`;
    descEl.textContent = desc;
    metaEl.textContent = `Wind ${Math.round(cur.windspeed)} km/h Â· Updated ${cur.time}`;

    // Forecast 7 days
    for (let i = 0; i < 7; i++) {
      const day = new Date(data.daily.time[i]).toLocaleDateString('en-US', { weekday: 'short' });
      const {emoji} = weatherMap[data.daily.weathercode[i]] || {emoji:'â“'};
      const maxF = Math.round(toF(data.daily.temperature_2m_max[i]));
      const minF = Math.round(toF(data.daily.temperature_2m_min[i]));

      const div = document.createElement('div');
      div.className = "bg-blue-50 rounded-lg p-2 text-center shadow";
      div.innerHTML = `
        <p class="text-xs font-semibold">${day}</p>
        <div class="text-2xl">${emoji}</div>
        <p class="text-xs text-slate-700">${maxF}Â° / ${minF}Â°</p>
      `;
      forecastEl.appendChild(div);
    }

  } catch (err) {
    errorEl.classList.remove('hidden');
    errorEl.textContent = 'âš ï¸ Error fetching weather data.';
  }
}

function hideWeather() {
  weatherCard.classList.add('hidden');
}

fetchAllTempsAndRender();
</script>
</body>
</html>
